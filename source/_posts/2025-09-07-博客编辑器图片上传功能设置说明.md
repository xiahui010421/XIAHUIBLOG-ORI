---
title: 博客编辑器图片上传功能设置说明
date: 2025-09-07T00:00:00.000Z
tags: [undefined]
categories: undefined
---

# 博客编辑器图片上传功能设置说明

## 依赖安装

首先安装必要的npm包：

```bash
npm install multer
```

如果还没有安装其他依赖：
```bash
npm install express cors body-parser
```

## 后端集成

### 1. 创建图片上传路由文件

将提供的API代码保存为 `routes/image-upload.js`（或其他合适的位置）

### 2. 在主应用中引入路由

```javascript
// app.js 或 server.js
const express = require('express');
const imageRoutes = require('./routes/image-upload');

const app = express();

// 中间件
app.use(express.json());
app.use(express.static('public')); // 确保静态文件服务

// 图片上传API路由
app.use('/api', imageRoutes);

// 其他路由...
```

### 3. 确保目录结构

确保你的项目有以下目录结构：
```
your-project/
├── public/
│   └── images/        # 图片存储目录（会自动创建子目录）
├── routes/
│   └── image-upload.js
└── app.js
```

## 前端集成

### 1. 更新编辑器JavaScript

将增强的 `editor.js` 代码替换你现有的编辑器脚本。

### 2. 确保编辑器页面引入了必要的库

```html
<script src="https://cdn.jsdelivr.net/npm/marked@4.2.12/marked.min.js"></script>
<script src="/js/editor.js"></script>
```

## 功能特性

### 支持的上传方式

1. **点击上传按钮** - 选择一个或多个图片文件
2. **拖拽上传** - 直接将图片拖到编辑器区域
3. **粘贴上传** - Ctrl+V 粘贴剪贴板中的图片

### 存储路径格式

图片会按照以下格式保存：
```
/images/年/月/博客标题/图片文件名
```

例如：
- 博客标题：`我的Vue学习笔记`
- 上传时间：2024年3月
- 存储路径：`/images/2024/03/我的vue学习笔记/1710123456789-a1b2c3d4.jpg`

### 安全特性

- **文件类型验证** - 只允许图片格式
- **文件大小限制** - 最大10MB
- **路径安全** - 防止目录遍历攻击
- **文件名安全** - 自动生成唯一、安全的文件名
- **身份验证** - 需要有效token才能上传

## 配置选项

### 修改上传限制

```javascript
const upload = multer({
  storage: storage,
  limits: {
    fileSize: 5 * 1024 * 1024, // 改为5MB
  },
  // ...
});
```

### 修改允许的文件类型

```javascript
fileFilter: (req, file, cb) => {
  const allowedTypes = /jpeg|jpg|png|gif|webp|svg/; // 添加svg支持
  // ...
}
```

### 修改Token验证

```javascript
// 在前端 editor.js 中
const token = 'your-actual-secret-token'; 

// 在后端 image-upload.js 中
if (token !== 'your-actual-secret-token') {
  return res.status(403).json({ error: '无效的访问令牌' });
}
```

## 使用方法

1. **编写博客时**：
   - 先输入博客标题
   - 点击"上传图片"按钮选择图片
   - 或者直接拖拽图片到编辑器
   - 或者复制图片后在编辑器中粘贴

2. **图片会自动插入Markdown格式**：
   ```markdown
   ![图片名称](/images/2024/03/博客标题/文件名.jpg)
   ```

3. **实时预览**：
   - 右侧预览区域会立即显示上传的图片

## 故障排除

### 常见问题

1. **上传失败**：
   - 检查文件大小是否超过限制
   - 确认文件类型是否支持
   - 验证token是否正确

2. **图片显示不出来**：
   - 确认 `public` 目录的静态文件服务已配置
   - 检查图片文件是否成功保存
   - 确认路径格式正确

3. **权限错误**：
   - 确保Node.js进程有写入 `public/images` 目录的权限
   - 在Linux/Mac上可能需要：`chmod 755 public/images`

## API接口说明

### 上传单张图片
```http
POST /api/upload-image
Authorization: Bearer your-token
Content-Type: multipart/form-data

FormData:
- image: 图片文件
- blogTitle: 博客标题
```

### 批量上传图片
```http
POST /api/upload-images
Authorization: Bearer your-token
Content-Type: multipart/form-data

FormData:
- images: 图片文件数组（最多10个）
- blogTitle: 博客标题
```

### 删除图片
```http
DELETE /api/delete-image
Authorization: Bearer your-token
Content-Type: application/json

{
  "imagePath": "images/2024/03/blog-title/filename.jpg"
}
```
